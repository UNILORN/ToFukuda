# 概要

シリアル通信の送受信サンプルプログラム

## 解説

### シリアル通信について

シリアル通信を行う際は、双方のプログラム内部に **送信** と **受信**　を記述する必要があります。

また、どちらか片方が **送信,受信待ち** となってしまった場合は、フローが停止してしまう為
必ずどちらかが **待ち** の時は期待する値になるように双方に同期を取らなければいけません。

上記の解説は、単純にデータ受信待ちであるプログラムAがあれば、プログラムBは次にシリアルを利用する時にデータ送信をすればいいだけです。

下記に登場する通信方法は基本的に**サーバ**と**クライアント**があり、それぞれにプログラム記述方法が違いますが、シリアル通信に関してはシリアルポートがサーバの役目を果たしており、双方のプログラム内容が同じでも動作します。
（つまり**どちらもクライアント**であるのと大差はない）

ですので、片方のクライアントはもう片方のクライアントが接続されてきても、基本的にはわかりません。
任意でテキストを投げるなどを行い、クライアント同士の同期を取りましょう。相手が本当にデータが受信できているかどうかも、相手方から「データが来て、動作完了しましたよ」というようなやり取りが勧められます。

このような通信の場合、データの損失などが発生しても許容されてしまいますので、完全なデータのやり取りを行う際にはあまりお勧めできません。
そういった場合は、HTTP通信であるとか、データ損失が許容されるような設計にしましょう。

（尚、通信の冗長化・可用性の向上・信頼性などを考え始めるとキリがないのでどこかで落とし所を決めましょう。実運用する際は障害が起きないように設計する必要があります）

### 通信について

今回は、物理ケーブル（USB,RS232Cなど）での通信にシリアルケーブルを用いましたが、
同じ端末（同じPC内部）で別々のプログラム同士を通信させたいケースが発生します。

例えば、Node.jsでしか配布されていないモジュールを利用したいが、シリアル通信はPythonで行いたい・・・などなど。。

このような場合、プログラム間（プロセス間）での通信を行う必要が出てきます。
この通信も、シリアル通信とほぼ同じようなフローで通信を行います。

通信する際は、どちらかが **待ち** の状態になり、片方が待っているプログラムに対してアクセスをしに行くのが一般的です。

この**待ち**となっているプログラムをサーバと言ったりもします。

サーバに対してアクセスを行い、通信が確立すれば通信開始となります。

### プロセス間通信について

プロセス間通信には様々な方法がありますが、安全かつ高速に利用できるのがUNIXドメインソケットです。

UNIXドメインソケット通信という名前ですが、単純にLinuxにソケットファイルを作成し、自動的にその内部でファイルの書き込み、読み込みを行うことでどの言語で作成されたプログラムからも送受信出来るような仕組みになっています。（ファイルを読み込んだり、ファイルに書き込んだりするのはOSの機能でどの言語でもその機能を利用することが可能な為）

ただし、条件として同じファイルを参照できるプログラムのみです。

ネットワークを超えた通信、コードなど物理的に接続されている者同士の通信などは、そのファイルのアクセス権などを変更するなどの工夫が必要ですし、セキュリティ的にもよくありません。

ですので、同じOS間で通信する場合に利用しましょう。

### HTTP通信について（ネットを超えて外部からのアクセスをしたい場合）

HTTPはハイパーテキストトランスファープロトコルといい、詳しい内容は省きますがネットワーク越しにデータのダウンロードやアップロード、及び通信を行う事が出来るプロトコルです。

通信をすべて暗号化してくれるHTTPSを利用すると、セキュアになっていいでしょう。ですが、認証局などの設定が必要な為こちらは省きます。

HTTP通信を行うに当たって、**サーバ** と **クライアント** が必要になります。

サーバは固定のIPアドレスを所持しており、クライアントはサーバのIPアドレス・ポート番号・パス・その他データ などを利用しサーバに様々な操作リクエストを行います。
ポート番号はHTTPだと80番,HTTPSだと443番がデフォルトで利用されます。IPアドレスはDNS（ドメインネームサーバ）によりアドレス（google.comなど)となっている場合が多いですが、DNSによりIPアドレスと紐付いているのでIPアドレスでも接続できます。

そのような宛先の情報をまとめて **URL** で表記しています。

`http://ipアドレス.ドメイン:ポート番号/パス（エンドポイント)`

パス以下の情報でサーバまで到達します。 サーバ内部のプログラムで**パス**の情報をさばきます。

ですので、サーバとなるプログラムでは基本的に、 `このパスでアクセスされたら ○○のような動作をし、△△を返送する` というようなロジックを書きます。

サーバから見れば**アクセスをされる**という表現ですが、クライアントからすれば**リクエストを送る**となります。
リクエストを送ったらレスポンスが無いと困ります。OKだったのかNGだったのかなどです。

```
クライアント -> リクエストを送る -> サーバ側で処理をする -> レスポンスを返す -> レスポンスを解釈し画面などに表示する
```

このようなフローでHTTP通信は行われます。

## 起動方法

1. `main.py` 内部のシリアルポートPathを変更
2. `python3 main.py` を実行

## Q&A

> Q. なぜPythonを利用したか

A. どれでもシリアル通信は可能ですが、Node.jsだと非同期通信の記述になってしまう可能性があり、極めて勉強コストが高いので同期通信であるPython,Go言語,C言語などを利用することをおすすめします。
ただし、Node,jsでHTTP通信をする場合や他に導入するべき要因がある場合はその限りではありません。言語選択は各個人のスキルに合わせて行いましょう。

> Q. プログラムが完成していない

諸事情でデバック出来てないので、動かない可能性があります。

> Q. ちょっと文字ばっかりで読みにくいです

ごめんなさい

> Q. 日本語がおかしいところがあります

申し訳ないです。Issueか、PRを送ってください。

